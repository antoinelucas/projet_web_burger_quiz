<?php

require_once("Manager.php");

class UserManager extends Manager{

  function __construct(){
    $db = $this->dbConnect();
    $this->setDb($db);
    //var_dump($db);
  }

//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
//----------------------------------------------------------------------------------------------- Méthode addUser -----------------------------------------------------------------------------------------------------------
//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  public function addUser(User $user){
    $req = $this->getDb()->prepare('INSERT INTO USER(pseudo, password, mail, name, lastname, vip, avatar) VALUES(:pseudo, :password, :mail, :name, :lastname, :vip, :avatar)');

    $req->bindValue(':pseudo', $user->getPseudo());
    $req->bindValue(':password', $user->getPassword());
    $req->bindValue(':mail', $user->getMail());
    $req->bindValue(':name', $user->getName());
    $req->bindValue(':lastname', $user->getLastname());
    $req->bindValue(':vip', $user->getVip(), PDO::PARAM_INT);
    $req->bindValue(':avatar', $user->getAvatar());

    $req->execute();
  }
//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
//----------------------------------------------------------------------------------------------- Méthode updateUser --------------------------------------------------------------------------------------------------------
//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  public function updateUser(User $user){
    //Prépare une requête de type Update
    //Assignation des valeurs à la raquête
    //Exécution de la requête
    $req = $this->getDb()->prepare('UPDATE USER SET password=:password, mail=:mail, name=:name, lastname=:lastname, vip=:vip, avatar=:avatar WHERE pseudo=:pseudo');

    $req->bindValue(':password', $user->getPassword());
    $req->bindValue(':mail', $user->getMail());
    $req->bindValue(':name', $user->getName());
    $req->bindValue(':lastname', $user->getLastname());
    $req->bindValue(':vip', $user->getVip(), PDO::PARAM_INT);
    $req->bindValue(':avatar', $user->getAvatar());
    $req->bindValue(':password', $user->getPassword());
    $req->bindValue(':pseudo', $user->getPseudo());

    $req->execute();
  }
//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------




//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
//----------------------------------------------------------------------------------------------- Méthode getUser -----------------------------------------------------------------------------------------------------------
//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  public function getUser($pseudo){
    ///$this->getDb()->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
    //Exécute une requête de type SELECT avec une clause Where et retourne un objet User
    $req = $this->getDb()->prepare('SELECT * FROM USER WHERE pseudo=:pseudo');
    $req->bindValue(':pseudo', $pseudo);
    $req->execute();
    //$this->getDb()->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
    $data = $req->fetch(PDO::FETCH_ASSOC);
    return $data;
  }
  //---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


  //---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  //----------------------------------------------------------------------------------------------- Méthode loginUser -----------------------------------------------------------------------------------------------------------
  //---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    public function loginUser($login){
      ///$this->getDb()->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
      //Exécute une requête de type SELECT avec une clause Where et retourne un objet User
      $req = $this->getDb()->prepare('SELECT * FROM USER WHERE (pseudo=:pseudo OR mail=:mail)');
      $req->bindValue(':pseudo', $login);
      $req->bindValue(':mail', $login);
      $req->execute();
      //$this->getDb()->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
      $data = $req->fetch(PDO::FETCH_ASSOC);
      return $data;
    }
    //---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


  //---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  //----------------------------------------------------------------------------------------------- Méthode deleteUser --------------------------------------------------------------------------------------------------------
  //---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  public function deleteUser(User $user){
    //Execute une requête de type delete
    $req = $this->getDb()->prepare('DELETE FROM USER WHERE pseudo =:pseudo');
    $req->bindValue(':pseudo', $user->getPseudo());
    $req->execute();
  }
  //---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

}
